#!/usr/bin/env bash

## Description: Start dev script inside theme folder with cleanup
## Usage: dev
## Example: ddev dev

DEFAULT_THEME_DIR="web/app/themes/default-theme"
HOT_FILE="$DEFAULT_THEME_DIR/public/hot"

# Clean up if the previous run crashed
rm -f $HOT_FILE 2>/dev/null
killall node 2>/dev/null || true

# Remove hot files generated by Vite
cleanup() {
  echo ""
  echo "Stopping dev server and cleaning up..."
  rm -f $HOT_FILE 2>/dev/null
  killall node 2>/dev/null || true
  exit
}

# Call cleanup function when script stopped
trap cleanup EXIT

cd $DEFAULT_THEME_DIR
npm run dev